{{- if .Values.create_env_var_secret }}
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: renovate-bot-secrets
  namespace: renovate
  annotations:
    argocd.argoproj.io/sync-wave: "1"
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name:

  # details about the actual secret we create
  target:
    creationPolicy: Owner
    deletionPolicy: Retain
    name: renovate-bot-secrets
    template:
      engineVersion: v2
      mergePolicy: Replace

      data:
        id_rsa: '{{`{{ .sshKey }}`}}'
        id_rsa.pub: '{{`{{ .sshPubKey }}`}}'

  # the external source we're pulling in for this secret
  data:
    - secretKey: sshKey
      remoteRef:
        key: renovate-bot-ssh-key

    - secretKey: sshPubKey
      remoteRef:
        key: renovate-bot-ssh-pub-key
{{- end }}
