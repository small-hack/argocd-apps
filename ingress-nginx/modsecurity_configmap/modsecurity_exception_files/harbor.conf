# -------------------------------------------------------------------------
# Prevent false positives for Remote Command Execution: Unix Command Injection
# (command without evasion) Rule ID #932235
# -------------------------------------------------------------------------
SecRule REQUEST_URI "@rx ^\/api\/v2.0\/registries.*" \
    "id:120001,\
    phase:1,\
    ver:'harbor-rule-exclusions-plugin/1.0.0',\
    pass,\
    t:none,\
    nolog,\
    ctl:ruleRemoveById=932235"

# -------------------------------------------------------------------------
# Prevent false positives for Remote Command Execution: Direct Unix Command Execution
# Rule ID #932260
# -------------------------------------------------------------------------
SecRule REQUEST_URI "@rx ^\/api\/v2.0\/registries.*" \
    "id:120002,\
    phase:1,\
    ver:'harbor-rule-exclusions-plugin/1.0.0',\
    pass,\
    t:none,\
    nolog,\
    ctl:ruleRemoveById=932260"

# -------------------------------------------------------------------------
# Allow users to manage repos in their projects
# Rule ID #911100
# -------------------------------------------------------------------------
SecRule REQUEST_URI "@rx ^\/api\/v2.0\/projects\/.*\/repositories\/.*" \
    "id:120003,\
    phase:1,\
    ver:'harbor-rule-exclusions-plugin/1.0.0',\
    pass,\
    t:none,\
    nolog,\
    setvar:'tx.allowed_methods=PUT POST GET HEAD OPTIONS DELETE'"

# -------------------------------------------------------------------------
# Allow users to manage members in their projects
# Rule ID #911100
# -------------------------------------------------------------------------
SecRule REQUEST_URI "@rx ^\/api\/v2.0\/projects\/.*\/members\/.*" \
    "id:120004,\
    phase:1,\
    ver:'harbor-rule-exclusions-plugin/1.0.0',\
    pass,\
    t:none,\
    nolog,\
    setvar:'tx.allowed_methods=PUT POST GET HEAD OPTIONS DELETE'"

# -------------------------------------------------------------------------
# Allow management of robot users
# Rule ID #911100
# -------------------------------------------------------------------------
SecRule REQUEST_URI "@rx ^\/api\/v2.0\/robots.*" \
    "id:120005,\
    phase:1,\
    ver:'harbor-rule-exclusions-plugin/1.0.0',\
    pass,\
    t:none,\
    nolog,\
    setvar:'tx.allowed_methods=PUT POST GET HEAD OPTIONS DELETE'"

# -------------------------------------------------------------------------
# Allow management of user CLI secret
# Rule ID #911100
# -------------------------------------------------------------------------
SecRule REQUEST_URI "@rx ^\/api\/v2.0\/users\/.*\/cli_secret" \
    "id:120006,\
    phase:1,\
    ver:'harbor-rule-exclusions-plugin/1.0.0',\
    pass,\
    t:none,\
    nolog,\
    setvar:'tx.allowed_methods=PUT POST GET HEAD OPTIONS DELETE'"

# -------------------------------------------------------------------------
# Allow self-management of user profile
# Rule ID #911100
# -------------------------------------------------------------------------
SecRule REQUEST_URI "@rx ^\/api\/v2.0\/users\/." \
    "id:120007,\
    phase:1,\
    ver:'harbor-rule-exclusions-plugin/1.0.0',\
    pass,\
    t:none,\
    nolog,\
    setvar:'tx.allowed_methods=PUT POST GET HEAD OPTIONS DELETE'"

# -------------------------------------------------------------------------
# Allow pushing manifests
# Rule ID #911100
# -------------------------------------------------------------------------
SecRule REQUEST_URI "@rx ^\/v2\/.*\/manifests\/.*" \
    "id:120008,\
    phase:1,\
    ver:'harbor-rule-exclusions-plugin/1.0.0',\
    pass,\
    t:none,\
    nolog,\
    setvar:'tx.allowed_methods=PUT POST GET HEAD OPTIONS DELETE'"

# -------------------------------------------------------------------------
# Allow content types associated with manifests
# Rule ID #920420
# -------------------------------------------------------------------------
SecRule REQUEST_URI "@rx ^\/v2\/.*" \
    "id:120009,\
    phase:1,\
    ver:'harbor-rule-exclusions-plugin/1.0.0',\
    pass,\
    t:none,\
    nolog,\
    setvar:'tx.allowed_request_content_type=|application/vnd.docker.distribution.manifest.v2+json|'"
