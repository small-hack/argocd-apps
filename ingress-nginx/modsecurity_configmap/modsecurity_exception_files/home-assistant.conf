# -------------------------------------------------------------------------
# home assistant rule exclusions
# -------------------------------------------------------------------------
# allow content type of text/plain, but process the body as JSON
SecRule REQUEST_URI "@beginsWith /auth/login_flow" \
  "id:50001,\
  phase:1,\
  ver:'home-assistant-rule-exclusions-plugin/1.0.0',\
  pass,\
  nolog,\
  t:none,\
  ctl:requestBodyProcessor=JSON,\
  setvar:'tx.allowed_request_content_type=|text/plain|'"


# Allow PUT method to login endpoint
SecRule REQUEST_URI "@beginsWith /auth/login_flow" \
  "id:50002,\
  phase:1,\
  ver:'home-assistant-rule-exclusions-plugin/1.0.0',\
  pass,\
  nolog,\
  t:none,\
  setvar:'tx.allowed_methods=PUT POST DELETE'"


# this is a legit endpoint for home assistant for some reason
SecRule REQUEST_URI "@rx /frontend_latest/.*.js$" \
  "id:50003,\
  phase:1,\
  ver:'home-assistant-rule-exclusions-plugin/1.0.0',\
  pass,\
  t:none,\
  nolog,\
  ctl:ruleRemoveById=930130"


# register sensor
SecRule REQUEST_URI "@beginsWith /api/webhook/" \
  "id:50004,\
  phase:1,\
  ver:'home-assistant-rule-exclusions-plugin/1.0.0',\
  pass,\
  t:none,\
  nolog,\
  ctl:ruleRemoveTargetById=933150;ARGS:json.data.unique_id"
